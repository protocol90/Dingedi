<?php

class Tools
{

    static function upload($file, $destination)
    {
        $extensions = array('png', 'jpg', 'jpeg');
        $ext = pathinfo($file['name'], PATHINFO_EXTENSION);

        if ($file['name'] != '') {
            if (in_array($ext, $extensions)) {
                if (move_uploaded_file($file['tmp_name'], $destination)) {
                    return true;
                } else {
                    return false;
                }
            } else {
                return false;
            }
        } else {
            return false;
        }
    }

    static function redirect($path, $time = 0)
    {
        return header("Location: $path");
    }

    function isValid($code, $ip = null)
    {
        if (empty($code)) {
            return false; // Si aucun code n'est entré, on ne cherche pas plus loin
        }
        $params = [
            'secret'    => '6LcdDxkTAAAAAC67bMVned5co1wYGVqMgXNMtRRo',
            'response'  => $code
        ];
        if( $ip ){
            $params['remoteip'] = $ip;
        }
        $url = "https://www.google.com/recaptcha/api/siteverify?" . http_build_query($params);
        if (function_exists('curl_version')) {
            $curl = curl_init($url);
            curl_setopt($curl, CURLOPT_HEADER, false);
            curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
            curl_setopt($curl, CURLOPT_TIMEOUT, 1);
            curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false); // Evite les problèmes, si le ser
            $response = curl_exec($curl);
        } else {
            // Si curl n'est pas dispo, un bon vieux file_get_contents
            $response = file_get_contents($url);
        }

        if (empty($response) || is_null($response)) {
            return false;
        }

        $json = json_decode($response);
        return $json->success;
    }
}